/*---------------------------------------------------------------------------------------------

@author       Constantin Saguin - @brutaldesign
@link         http://csag.co
@github       http://github.com/One-com/shinybox
@version      5.1.0
@license      MIT License

----------------------------------------------------------------------------------------------*/
!function(a){"object"==typeof exports?module.exports=a(require("jQuery")):"function"==typeof define&&define.amd?define(["jquery"],a):window.Shinybox=a(jQuery)}(function(a){!function(a,b,c,d){function e(a,b){function d(a){if("slide current"===a.target.parentNode.className)return!1;a.preventDefault(),a.stopPropagation(),i.ui&&i.ui.destroy();var b=c(this),d="data-rel",e=b.attr(d);e||(d="rel",e=b.attr(d));var j;j=e&&"nofollow"!==e?h.filter("["+d+'="'+e+'"]'):c(l);var m=Array.prototype.filter.call(j,function(a){return!c(a).data("ignore")}),n="undefined"!=typeof b.data("dom-index")?b.data("dom-index")-c(m[0]).data("dom-index"):c(m).index(b),o=Array.prototype.map.call(m,function(a){var b=c(a);return{href:b.attr("href")||null,title:b.attr("title")||null,caption:b.attr("caption")||null,srcset:b.attr("data-srcset")||null}});g=c(a.target),i.ui=new f(o,k),g.trigger("shinybox-start"),i.ui.openWithSlide(n)}var g,h,i=this instanceof e?this:{},k=c.extend({},r,b),l=a.selector;return k.afterDestroy=function(){g.trigger("shinybox-destroy"),i.ui=null},c.isArray(a)?(g=j,i.destroy=function(){i.ui&&i.ui.destroy()},i.refresh=function(){i.destroy(),i.ui=new f(a,k),g.trigger("shinybox-start"),i.ui.openWithSlide(k.initialIndexOnArray)}):(i.destroy=function(){h&&h.off("click",d),i.ui&&i.ui.destroy()},i.refresh=function(){i.destroy(),h=a,k.sort&&h.sort(k.sort),h.on("click",d)}),i.refresh(),i}function f(a,b){this.slides=a,this.settings=b,this.currentX=0,this.build()}function g(){}function h(){var a=["transition","WebkitTransition","MozTransition","OTransition","msTransition","KhtmlTransition"];return a.some(function(a){return b.createElement("div").style[a]!==d})}function i(){return{width:a.innerWidth?a.innerWidth:j.width(),height:a.innerHeight?a.innerHeight:j.height()}}var j=c(a),k=c("html"),l=c(b.body),m=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(Android)|(PlayBook)|(BB10)|(BlackBerry)|(Opera Mini)|(IEMobile)|(webOS)|(MeeGo)/i),n=null!==m||b.createTouch!==d||"ontouchstart"in a||"onmsgesturechange"in a||navigator.msMaxTouchPoints,o=(!!b.createElementNS&&!!b.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,h()),p=i(),q=[function(){p=i()}];j.resize(function(a){q.forEach(function(b){b(a)})}),"onorientationchange"in a&&a.addEventListener("orientationchange",function(){p=i()},!1);var r={id:"shinybox-overlay",useCSS:!0,noTitleCaptionBox:!1,hideCloseButtonOnMobile:!1,loopAtEnd:!1,showNavigationsOnMobile:!1,initialIndexOnArray:0,sort:null,videoMaxWidth:1140,autoplayVideos:!1,vimeoColor:"CCCCCC",queryStringData:{},beforeOpen:g,afterClose:g,afterMedia:g,afterSlide:g,verticalSwipeDisable:!1};return f.prototype.build=function(){this.overlay=c('<div id="'+this.settings.id+'"  class="shinybox-overlay" />'),this.closeButton=c('<a class="shinybox-close" />'),this.captionBox=c('<div class="shinybox-caption captionTitle"></div>'),this.caption=c('<p class="caption"></p>'),this.title=c('<p class="title"></p>'),this.captionBox.append(this.title,this.caption),this.navigationContainer=c('<div class="navigationContainer"></div>'),this.slider=c('<div class="shinybox-slider"></div>'),this.prevButton=c('<a class="shinybox-prev" />'),this.nextButton=c('<a class="shinybox-next" />'),this.navigationContainer.append(this.prevButton,this.nextButton),this.overlay.append(this.slider,this.closeButton,this.captionBox,this.navigationContainer),m&&this.overlay.addClass("mobile-view"),this.settings.noTitleCaptionBox&&this.overlay.addClass("noTitleCaptionBox"),this.settings.showNavigationsOnMobile||this.navigationContainer.addClass("hideMe"),l.append(this.overlay),this.slides.forEach(function(){this.slider.append('<div class="slide"></div>')},this),this.slideElements=this.slider.find(".slide"),this.updateDimensions(),this.setupButtonNavigation(),this.setupGestureNavigation(),this.setupKeyboardNavigation(),this.setupWindowResizeEvent()},f.prototype.doCssTrans=function(){return this.settings.useCSS&&o},f.prototype.updateDimensions=function(){c.extend({},p)},f.prototype.setupButtonNavigation=function(){var a=this;this.slides.length<2?this.navigationContainer.hide():(this.prevButton.on("click touchend",function(b){b.preventDefault(),b.stopPropagation(),a.getPrev()}),this.nextButton.on("click touchend",function(b){b.preventDefault(),b.stopPropagation(),a.getNext()})),this.closeButton.on("click touchend",function(b){b.preventDefault(),b.stopPropagation(),a.destroy()}),this.slideElements.click(function(b){b.target===this&&b.target.children.length>=1&&a.destroy()})},f.prototype.setupGestureNavigation=function(){if(n){var a,b,d,e,f,g,h=this,i=!1,j=!1,k=10,l=50,m={},o={},q=function(c){if(c.preventDefault(),c.stopPropagation(),o=c.originalEvent.targetTouches[0],!j&&!h.settings.verticalSwipeDisable&&(f=d,d=o.pageY-m.pageY,Math.abs(d)>=l||i)){var n=.75-Math.abs(d)/h.slider.height();h.slider.css({top:d+"px",opacity:n}),i=!0}e=b,b=o.pageX-m.pageX,g=100*b/p.width,!j&&!i&&Math.abs(b)>=k&&(h.slider.addClass("notransition"),j=!0),j&&(0<b?h.moveSlider(h.currentX+(0===a?4:g)):0>b&&h.moveSlider(h.currentX+(h.slides.length===a+1?-4:g)))},r=null;this.overlay.on("touchstart",function(b){return b.originalEvent.touches&&b.originalEvent.touches.length>1?(c(this).off("touchmove",q),!0):(b.preventDefault(),b.stopPropagation(),a=h.getCurrentIndex(),o=b.originalEvent.targetTouches[0],r=b.originalEvent.targetTouches,m.pageX=b.originalEvent.targetTouches[0].pageX,m.pageY=b.originalEvent.targetTouches[0].pageY,h.moveSlider(h.currentX),void c(this).on("touchmove",q))}),this.overlay.on("touchend",function(a){if(a.originalEvent.touches&&a.originalEvent.touches.length>1)return c(this).off("touchmove",q),!0;a.stopPropagation(),h.slider.removeClass("notransition"),d=o.pageY-m.pageY,b=o.pageX-m.pageX;var g=1===r.length;if(i&&!h.settings.verticalSwipeDisable)if(i=!1,Math.abs(d)>=2*l&&Math.abs(d)>Math.abs(f)&&g){var n=d>0?h.slider.height():-h.slider.height();h.slider.animate({top:n+"px",opacity:0},300,function(){h.destroy()})}else h.slider.animate({top:0,opacity:1},300);else j&&(j=!1,b>=k&&b>=e&&g?h.getPrev():b<=-k&&b<=e&&g&&h.getNext());h.moveSlider(h.currentX),c(this).off("touchmove",q)})}},f.prototype.setupKeyboardNavigation=function(){var a=this;this._keyDownEvent=function(b){return!a.isOpen||void(37===b.keyCode||8===b.keyCode?(b.preventDefault(),b.stopPropagation(),a.getPrev()):39===b.keyCode?(b.preventDefault(),b.stopPropagation(),a.getNext()):27===b.keyCode&&(b.preventDefault(),b.stopPropagation(),a.destroy()))},j.on("keydown",this._keyDownEvent)},f.prototype.setupWindowResizeEvent=function(){var a=this;this.resizeIndex=q.push(function(){a.updateDimensions()})-1},f.prototype.validateIndex=function(a){return a<0||a>this.slides.length-1?0:a},f.prototype.getCurrentIndex=function(){return this.slideElements.index(this.slideElements.filter(".current"))},f.prototype.moveSlider=function(a){this.doCssTrans()?this.slider.css({left:a+"%"}):this.slider.animate({left:a+"%"})},f.prototype.setSlide=function(a,b){b=b||!1,a=this.validateIndex(a),this.currentX=100*-a,this.moveSlider(this.currentX),this.slideElements.removeClass("current"),this.slideElements.eq(a).addClass("current"),this.setTitle(a),b&&this.slider.fadeIn(),this.settings.loopAtEnd||(this.prevButton.removeClass("disabled"),this.nextButton.removeClass("disabled"),0===a?this.prevButton.addClass("disabled"):a===this.slides.length-1&&this.nextButton.addClass("disabled")),this.settings.afterSlide(this.slideElements.filter(".current").children(),a)},f.prototype.setTitle=function(a){a=this.validateIndex(a);var b=this.slides[a].title,c=this.slides[a].caption;b||c?this.captionBox.removeClass("noTitleCaption"):this.captionBox.addClass("noTitleCaption"),this.caption.text(c||""),this.title.text(b||"")},f.prototype.openWithSlide=function(a){a=this.validateIndex(a);var b=a<this.slides.length-1?a+1:0,c=a>0?a-1:this.slides.length-1;this.open(),this.setSlide(a),this.preloadMedia(a),(this.settings.loopAtEnd||0!==b)&&this.preloadMedia(b),(this.settings.loopAtEnd||c!==this.slides.length-1)&&this.preloadMedia(c)},f.prototype.getNext=function(){var a=this,b=this.getCurrentIndex(),c=b+1<this.slides.length?b+1:0,d=c+1<this.slides.length?c+1:0;this.settings.loopAtEnd||b+1<this.slides.length?(this.resetIframeInSlide(b),this.setSlide(c),this.preloadMedia(d)):(this.overlay.addClass("rightSpring"),setTimeout(function(){a.overlay.removeClass("rightSpring")},500))},f.prototype.getPrev=function(){var a=this,b=this.getCurrentIndex(),c=b>0?b-1:this.slides.length-1,d=c>0?c-1:this.slides.length-1;this.settings.loopAtEnd||b>0?(this.resetIframeInSlide(b),this.setSlide(c),this.preloadMedia(d)):(this.overlay.addClass("leftSpring"),setTimeout(function(){a.overlay.removeClass("leftSpring")},500))},f.prototype.resetIframeInSlide=function(a){a=this.validateIndex(a);var b=this.slideElements.eq(a).contents().find("iframe");b.length&&b.attr("src",b.attr("src"))},f.prototype.preloadMedia=function(a){a=this.validateIndex(a);var b=this,c=this.slides[a].href,d=this.slides[a].srcset;this.isVideo(c)?this.openMedia(a,c,d):setTimeout(function(){b.openMedia(a,c,d)},300)},f.prototype.openMedia=function(a,b,c){a=this.validateIndex(a);var d=this,e=this.slides[a].title||"",f=this.slides[a].alt||e;if(b||(b=this.slides[a].href),c||(c=this.slides[a].srcset),!b)return!1;var g=this.slideElements.eq(a);this.isVideo(b)?(g.html(this.getVideo(b)),this.settings.afterMedia(g.children(),a)):this.isPDF(b)?(g.html(this.getPDF(b)),this.settings.afterMedia(g.children(),a)):(g.html('<div class="loadingWrapper"><div class="loading"></div></div>'),this.loadMedia(b,c,function(b){b.attr("title",e),b.attr("alt",f),g.html(b),d.settings.afterMedia(g.children(),a)}))},f.prototype.loadMedia=function(a,b,d){if(d=d||g,0===a.trim().indexOf("#"))d(c('<div class="shinybox-inline-container" />').append(c(a).clone()));else{var e=c("<img>").on("load",function(){d(e)});e.attr("src",a),e.attr("srcset",b)}},f.prototype.open=function(){this.isOpen=!0,this.settings.beforeOpen(),k.addClass("shinybox-html"),m&&this.settings.hideCloseButtonOnMobile&&k.addClass("shinybox-no-close-button"),j.trigger("resize")},f.prototype.close=function(){k.removeClass("shinybox-html shinybox-no-close-button"),j.trigger("resize"),this.settings.afterClose(),this.isOpen=!1},f.prototype.destroy=function(){this.close(),j.off("keydown",this._keyDownEvent),q.splice(this.resizeIndex,1),this.overlay.remove(),this.settings.afterDestroy()},f.prototype.isPDF=function(a){return!!a&&a.match(/\.pdf(?:\?|$)/)},f.prototype.getPDF=function(a){var b='<iframe src="'+a+'">';return'<div class="shinybox-pdf-container"><div class="shinybox-pdf">'+b+"</div></div>"},f.prototype.isVideo=function(a){if(a){if(a.match(/(youtube\.com|youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/)||a.match(/vimeo\.com\/([0-9]*)/)||a.match(/youtu\.be\/([a-zA-Z0-9\-_]+)/))return!0;if(a.toLowerCase().indexOf("shinyboxvideo=1")>=0)return!0}},f.prototype.parseURI=function(a,d){var e=b.createElement("a"),f={};return e.href=decodeURIComponent(a),e.search&&(f=JSON.parse('{"'+e.search.toLowerCase().replace("?","").replace(/&/g,'","').replace(/=/g,'":"')+'"}')),c.isPlainObject(d)&&(f=c.extend(f,d,this.settings.queryStringData)),c.map(f,function(a,b){if(a&&a>"")return encodeURIComponent(b)+"="+encodeURIComponent(a)}).join("&")},f.prototype.getVideo=function(a){var b="",c=a.match(/((?:www\.)?youtube\.com|(?:www\.)?youtube-nocookie\.com)\/watch\?v=([a-zA-Z0-9\-_]+)/),d=a.match(/(?:www\.)?youtu\.be\/([a-zA-Z0-9\-_]+)/),e=a.match(/(?:www\.)?vimeo\.com\/([0-9]*)/),f="";return c||d?(d&&(c=d),f=this.parseURI(a,{autoplay:this.settings.autoplayVideos?"1":"0",v:""}),b='<iframe width="560" height="315" src="//'+c[1]+"/embed/"+c[2]+"?"+f+'" frameborder="0" allowfullscreen></iframe>'):e?(f=this.parseURI(a,{autoplay:this.settings.autoplayVideos?"1":"0",byline:"0",portrait:"0",color:this.settings.vimeoColor}),b='<iframe width="560" height="315"  src="//player.vimeo.com/video/'+e[1]+"?"+f+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'):b='<iframe width="560" height="315" src="'+a+'" frameborder="0" allowfullscreen></iframe>','<div class="shinybox-video-container" style="max-width:'+this.settings.videomaxWidth+'px"><div class="shinybox-video">'+b+"</div></div>"},c.shinybox=e,c.fn.shinybox=function(a){var b=this.data("_shinybox");if(b&&"destroy"===a)return b.destroy(),this.removeData("_shinybox");if(!b){var c=new e(this,a);this.data("_shinybox",c)}return this.data("_shinybox")},e}(window,document,a)}),function(a){var b=!1,c=function(c,d){0!==c.length&&c.shinybox({verticalSwipeDisable:!0,beforeOpen:function(){b?a(".shinybox-overlay").addClass("mobile-view"):a(".shinybox-overlay").removeClass("mobile-view")},noTitleCaptionBox:d,sort:function(b,c){if(a(b).length){var d=a(b).offset(),e=a(c).offset();return d.top-e.top!==0?d.top-e.top:d.left-e.left!==0?d.left-e.left:a(b).data("dom-index")-a(c).data("dom-index")}return 1}})},d=function(){var b=a(this);c(b.find(".shinybox"),0===b.find("div[data-captionenabled='true']").length)};a(".shinybox").each(function(b){a(this).attr("data-dom-index",b)}),c(a('div[data-kind="IMAGE"] .shinybox'),!1),a('div[data-kind="GALLERY"]').each(d),a(window).one("changed-to-mobile-view",function(){b=!0})}(oneJQuery);